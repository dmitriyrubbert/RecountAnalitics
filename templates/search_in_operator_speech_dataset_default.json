{
  "script": {
    "lang": "mustache",
    "source": {
      "size": 1000,
      "sort": [
        {
          "@timestamp": {
            "order": "asc",
            "format": "strict_date_optional_time_nanos"
          }
        }
      ],
      "query": {
        "bool": {
          "must": [],
          "filter": [
            {
              "bool": {
                "should": [
                  {
                    "bool": {
                      "filter": [
                        {
                          "bool": {
                            "should": [
                              {
                                "match": {
                                  "direction": "in"
                                }
                              }
                            ],
                            "minimum_should_match": 1
                          }
                        },
                        {
                          "bool": {
                            "should": [
                              {
                                "match_phrase": {
                                  "dstAnnotation": "{{word}}"
                                }
                              }
                            ],
                            "minimum_should_match": 1
                          }
                        }
                      ]
                    }
                  },
                  {
                    "bool": {
                      "filter": [
                        {
                          "bool": {
                            "should": [
                              {
                                "match": {
                                  "direction": "out"
                                }
                              }
                            ],
                            "minimum_should_match": 1
                          }
                        },
                        {
                          "bool": {
                            "should": [
                              {
                                "match_phrase": {
                                  "srcAnnotation": "{{word}}"
                                }
                              }
                            ],
                            "minimum_should_match": 1
                          }
                        }
                      ]
                    }
                  }
                ],
                "minimum_should_match": 1
              }
            },
            {
              "range": {
                "@timestamp": {
                  "format": "strict_date_optional_time",
                  "gte": "{{gte}}",
                  "lte": "{{lte}}"
                }
              }
            }
          ],
          "should": [],
          "must_not": [
            {
              "exists": {
                "field": "dataset_id"
              }
            }
          ]
        }
      }
    },
    "params": {
      "word": "поиск в речи оператора датасет NULL",
      "gte": "2021-05-31T21:00:00.000Z",
      "lte": "2022-06-01T07:51:54.575Z"
    }
  }
}