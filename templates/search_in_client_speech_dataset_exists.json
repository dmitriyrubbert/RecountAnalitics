{
  "script": {
    "lang": "mustache",
    "source": {
      "_source": ["@timestamp", "interactionID", "dataset_id"],
      "from": "{{from}}",
      "size": "{{size}}",
      "sort": [
        {
          "@timestamp": {
            "order": "asc",
            "format": "strict_date_optional_time_nanos"
          }
        }
      ],
      "query": {
        "bool": {
          "must": [],
          "filter": [
            {
              "bool": {
                "should": [
                  {
                    "bool": {
                      "filter": [
                        {
                          "bool": {
                            "should": [
                              {
                                "match": {
                                  "direction": "in"
                                }
                              }
                            ],
                            "minimum_should_match": 1
                          }
                        },
                        {
                          "bool": {
                            "should": [
                              {
                                "match_phrase": {
                                  "srcAnnotation": "{{word}}"
                                }
                              }
                            ],
                            "minimum_should_match": 1
                          }
                        }
                      ]
                    }
                  },
                  {
                    "bool": {
                      "filter": [
                        {
                          "bool": {
                            "should": [
                              {
                                "match": {
                                  "direction": "out"
                                }
                              }
                            ],
                            "minimum_should_match": 1
                          }
                        },
                        {
                          "bool": {
                            "should": [
                              {
                                "match_phrase": {
                                  "dstAnnotation": "{{word}}"
                                }
                              }
                            ],
                            "minimum_should_match": 1
                          }
                        }
                      ]
                    }
                  }
                ],
                "minimum_should_match": 1
              }
            },
            {
              "range": {
                "@timestamp": {
                  "format": "strict_date_optional_time",
                  "gte": "{{gte}}",
                  "lte": "{{lte}}",
                  "time_zone": "Europe/Moscow"
                }
              }
            },
            {
              "match_phrase": {
                "dataset_id": "{{dataset_id}}"
              }
            }
          ],
          "should": [],
          "must_not": []
        }
      }
    },
    "params": {
      "word": "поиск в речи клиента датасет 70"
    }
  }
}
